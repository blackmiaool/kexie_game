"use strict";

var gulpConfig = { plots: [{ "name": "kexie_first.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\js\\plot\\kexie_first.js", "relativePath": "kexie_first.js" }, { "name": "nature_test.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\js\\plot\\nature_test.js", "relativePath": "nature_test.js" }, { "name": "start.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\js\\plot\\start.js", "relativePath": "start.js" }, { "name": "xuanjianghui.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\js\\plot\\xuanjianghui.js", "relativePath": "xuanjianghui.js" }], scenes: [{ "name": "bigmap", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\bigmap", "relativePath": "bigmap", "files": [{ "name": "bigmap.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\bigmap\\bigmap.html", "relativePath": "bigmap\\bigmap.html" }, { "name": "bigmap.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\bigmap\\bigmap.js", "relativePath": "bigmap\\bigmap.js" }, { "name": "bigmap.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\bigmap\\bigmap.less", "relativePath": "bigmap\\bigmap.less" }] }, { "name": "character", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\character", "relativePath": "character", "files": [{ "name": "character.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\character\\character.html", "relativePath": "character\\character.html" }, { "name": "character.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\character\\character.js", "relativePath": "character\\character.js" }, { "name": "character.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\character\\character.less", "relativePath": "character\\character.less" }] }, { "name": "chat", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\chat", "relativePath": "chat", "files": [{ "name": "chat.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\chat\\chat.html", "relativePath": "chat\\chat.html" }, { "name": "chat.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\chat\\chat.js", "relativePath": "chat\\chat.js" }, { "name": "chat.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\chat\\chat.less", "relativePath": "chat\\chat.less" }] }, { "name": "cover", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\cover", "relativePath": "cover", "files": [{ "name": "cover.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\cover\\cover.html", "relativePath": "cover\\cover.html" }, { "name": "cover.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\cover\\cover.js", "relativePath": "cover\\cover.js" }, { "name": "cover.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\cover\\cover.less", "relativePath": "cover\\cover.less" }] }, { "name": "home", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\home", "relativePath": "home", "files": [{ "name": "home.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\home\\home.html", "relativePath": "home\\home.html" }, { "name": "home.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\home\\home.js", "relativePath": "home\\home.js" }, { "name": "home.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\home\\home.less", "relativePath": "home\\home.less" }] }, { "name": "make", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make", "relativePath": "make", "files": [{ "name": "make.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make\\make.html", "relativePath": "make\\make.html" }, { "name": "make.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make\\make.js", "relativePath": "make\\make.js" }, { "name": "make.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make\\make.less", "relativePath": "make\\make.less" }] }, { "name": "make-select", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make-select", "relativePath": "make-select", "files": [{ "name": "make-select.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make-select\\make-select.html", "relativePath": "make-select\\make-select.html" }, { "name": "make-select.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make-select\\make-select.js", "relativePath": "make-select\\make-select.js" }, { "name": "make-select.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\make-select\\make-select.less", "relativePath": "make-select\\make-select.less" }] }, { "name": "preload", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\preload", "relativePath": "preload", "files": [{ "name": "preload.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\preload\\preload.html", "relativePath": "preload\\preload.html" }, { "name": "preload.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\preload\\preload.js", "relativePath": "preload\\preload.js" }, { "name": "preload.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\preload\\preload.less", "relativePath": "preload\\preload.less" }] }, { "name": "save", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\save", "relativePath": "save", "files": [{ "name": "save.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\save\\save.html", "relativePath": "save\\save.html" }, { "name": "save.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\save\\save.less", "relativePath": "save\\save.less" }] }, { "name": "state", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\state", "relativePath": "state", "files": [{ "name": "state.html", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\state\\state.html", "relativePath": "state\\state.html" }, { "name": "state.js", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\state\\state.js", "relativePath": "state\\state.js" }, { "name": "state.less", "fullpath": "C:\\Users\\blackmiaool\\Documents\\mynutstore\\github\\kexie_game\\scene\\state\\state.less", "relativePath": "state\\state.less" }] }] };
//Here inject gulpConfig veriable
(function () {
    //    console.log(gulpConfig)
    var plotPaths = gulpConfig.plots.map(function (v, i) {
        return v.name.split(".")[0];
    });
    var scenePaths = gulpConfig.scenes.map(function (v, i) {
        return v.name.split(".")[0];
    });

    var config = {
        baseUrl: "js",
        paths: {
            jquery: "jquery.min",
            angular: "angular.min",
            "_": "underscore",
            "angular-animate": "angular-animate.min"
        },
        plotPaths: plotPaths,
        scenePaths: scenePaths,
        sysPaths: ["sys", "common", "dbg", "config", "scene", "plotApi"],
        map: {},
        shim: {
            "angular": {
                deps: ['jquery'],
                exports: 'angular'
            },
            "angular-animate": {
                deps: ["angular"]
            }
        }
    };
    config.sysPaths.forEach(function (v, i, a) {
        config.paths["system-" + v] = "system/" + v;
    });

    config.scenePaths.forEach(function (v, i, a) {
        config.paths[v] = "scene/" + v;
    });

    config.plotPaths.forEach(function (v, i, a) {
        config.paths[v] = "plot/" + v;
    });

    requirejs.config(config);

    requirejs(["jquery", "system-sys", "angular", 'angular-module', "system-scene", "res", "system-common", 'z', 'angular-animate', "plot", "deep-ui"].concat(gulpConfig.scenes.map(function (v) {
        return v.name;
    })), function ($, sys, angular, module, scene, res, common, z) {
        $("#game-first-tip").remove();
        module.controller("RootController", ["$rootScope", "$scope", function (rsp, sp) {

            common.$rootScope = angular.element("body").scope().$parent.$root;

            function getPre(skill) {
                var preText = "";
                skill.pre.forEach(function (v, i) {
                    if (i > 0) preText += " , ";
                    preText += z.skill.name + "Lv" + v.level;
                });
                if (!preText) {
                    preText = "无";
                }
                return preText;
            }

            function getItemIcon(item, color) {

                if (typeof item === "string") {
                    item = res.devices[item];
                }

                return common.resPath + "icon/item/" + color + "/" + item.icon + ".svg";
            }

            function getRes(str) {
                return common.g(str);
            }

            function goScene(str) {
                for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                    args[_key - 1] = arguments[_key];
                }

                scene.go.apply(scene, [str].concat(args));
            }

            function getSkillIcon(skill) {

                if (typeof skill === "string") {
                    skill = res.skills[skill];
                }

                if (z.skill[skill.name].satisfied && z.power >= getAction("学习").consume) {
                    return common.resPath + "skills/" + skill.icon + ".jpg";
                } else {
                    return common.resPath + "skills/" + skill.icon + "-off.jpg";
                }
            }

            function getSkillBg(skill) {
                if (typeof skill === "string") {
                    skill = res.skills[skill];
                }
                var color = "green";
                if (skill.pre.length != 0 && !z.skill[skill.name].satisfied) {

                    color = "grey";
                } else if (z.skill[skill.name].level >= 10) {
                    color = "yellow";
                }
                return common.resPath + "skills/icon-over-" + color + ".gif";
            }

            function openDebugPanel() {
                sp.showDebug = !sp.showDebug;
                console.log(scenePaths);
            }

            function debugScene(sceneName) {
                localStorage.setItem("debug-scene", sceneName);
                sp.goScene(sceneName);
                sp.showDebug = !sp.showDebug;
            }

            function clearHovering() {
                rsp.hoveringKind = "";
                delete rsp.hovering;
            }
            rsp.hoveringKind = "";
            rsp.clearHovering = clearHovering;

            var scenes = {};
            scenePaths.forEach(function (v, i) {
                scenes[v] = false;
            });
            $(".scene-wrap").show();
            common.$rootScope.scenes = scenes;
            _.extend(sp, {
                img: res.img,
                z: z,
                res: res,
                //                scenes,
                scenePaths: scenePaths,
                getPre: getPre,
                getItemIcon: getItemIcon,
                getRes: getRes,
                goScene: goScene,
                getSkillIcon: getSkillIcon,
                getSkillBg: getSkillBg,
                openDebugPanel: openDebugPanel,
                debugScene: debugScene
            });
            setTimeout(function () {
                scene.go("preload");
            });
        }]);
        angular.bootstrap("body", ['homeApp']);
    });
})();